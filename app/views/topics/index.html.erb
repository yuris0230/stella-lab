<div class="page-content">
  <header class="page-header">
    <h1 class="page-title">Topics</h1>
    <p class="page-lead">
      Community topics and discussions. Feel free to read and join the conversation.
    </p>
    <p class="page-muted">
      To start a new topic, open a character or item page and click “Start topic”.
    </p>
  </header>

  <% if @topics.present? %>
    <section class="page-section">
      <div class="topic-list">
        <% @topics.each do |topic| %>
          <% creator = topic.created_by_user %>

          <div class="topic-row">
            <!-- คลิกทั้งกล่องนี้ไปหน้า topic -->
            <%= link_to topic_path(topic), class: "topic-row-link" do %>
              <div class="topic-row-main">
                <div class="topic-row-title"><%= topic.title %></div>
              </div>

              <div class="topic-row-meta">
                <span class="topic-row-meta-item">
                  Started by
                  <%= creator&.user_profile&.display_name ||
                      creator&.name ||
                      "Unknown user" %>
                </span>

                <span class="topic-row-meta-item">
                  <%= topic.posts.size %> <%= "post".pluralize(topic.posts.size) %>
                </span>

                <span class="topic-row-meta-item">
                  <%= topic.created_at.strftime('%Y-%m-%d %H:%M') %>
                </span>

                <% if topic.locked? || topic.status_closed? %>
                  <span class="topic-row-meta-item">
                    <span class="topic-pill topic-pill-locked">Locked</span>
                  </span>
                <% end %>
              </div>
            <% end %>

            <!-- แถว like ด้านล่าง (อยู่นอกลิงก์หลัก) -->
            <div class="topic-row-actions" style="margin-top: 6px; display: flex; justify-content: flex-end; gap: 8px; align-items: center;">
              <span class="topic-row-meta-item" style="color: var(--app-text-muted);">
                ♥ <%= topic.likes.count %>
              </span>

              <% if user_signed_in? %>
                <% if liked_by_current_user?(topic) %>
                  <%= link_to "Unlike",
                              like_path(likeable_type: "Topic", likeable_id: topic.id),
                              method: :delete,
                              class: "app-pill-button",
                              data: { turbo: false } %>
                <% else %>
                  <%= link_to "Like",
                              like_path(likeable_type: "Topic", likeable_id: topic.id),
                              method: :post,
                              class: "app-pill-button",
                              data: { turbo: false } %>
                <% end %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </section>
  <% else %>
    <p class="page-muted">
      There are no topics yet. Be the first to start one from a character or item page.
    </p>
  <% end %>
</div>